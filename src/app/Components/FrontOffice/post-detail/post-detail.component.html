<div *ngIf="post" class="post-detail-container">
  <!-- Post Content -->
   

  <div class="post-header">
    <h2 class="post-title">{{ post.title }}</h2>
    <img [src]="'http://localhost:8082/posts/images/' + post.imageUrl" alt="Post Image" class="post-image" />
    <p class="post-content">{{ post.content }}</p>
    <p class="post-author"><strong>Posted By :</strong> {{ authorName }} </p>

    
  </div>
  <time [attr.datetime]="post.createdAt">
    📅 Posted At :{{ post.createdAt | date: 'medium' }} ,
    Category : {{ formatCategory(post.type) }}
  </time>
 <!-- Map Section: Display only if latitude and longitude are not the default values -->
 <div *ngIf="latitude !== 36.8065 || longitude !== 10.1815">
  <h2 class="post-title">Last Seen in </h2>
  <div id="map" class="map-container"></div>
</div>
 <!-- Modify Post Button -->
<button 
*ngIf="post.userId === userId" 
class="modify-post-button" 
[routerLink]="['/modify-post', post.id]">
✏️ Modify
</button>

<!-- Delete Post Button -->
<button 
*ngIf="post.userId === userId"  
class="delete-post-button" 
(click)="openDeleteModal(post.id)">
🗑️ Delete
</button>


  
  <div *ngIf="isDeleted" class="notification">
    Comment deleted successfully!
  </div>
  
<!-- Likes Section for Post -->
<div class="likes-section">
  <!-- Like Button -->
  <button class="like-button" aria-label="like" type="button" (click)="likePost(post.id)">
    <svg viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon">
      <path d="M 24.10 6.29 Q 28.34 7.56 28.00 12.00 Q 27.56 15.10 27.13 18.19 A 0.45 0.45 4.5 0 0 27.57 18.70 Q 33.16 18.79 38.75 18.75 Q 42.13 18.97 43.23 21.45 Q 43.91 22.98 43.27 26.05 Q 40.33 40.08 40.19 40.44 Q 38.85 43.75 35.50 43.75 Q 21.75 43.75 7.29 43.75 A 1.03 1.02 0.0 0 1 6.26 42.73 L 6.42 19.43 A 0.54 0.51 -89.4 0 1 6.93 18.90 L 14.74 18.79 A 2.52 2.31 11.6 0 0 16.91 17.49 L 22.04 7.17 A 1.74 1.73 21.6 0 1 24.10 6.29 Z M 21.92 14.42 Q 20.76 16.58 19.74 18.79 Q 18.74 20.93 18.72 23.43 Q 18.65 31.75 18.92 40.06 A 0.52 0.52 88.9 0 0 19.44 40.56 L 35.51 40.50 A 1.87 1.83 5.9 0 0 37.33 39.05 L 40.51 23.94 Q 40.92 22.03 38.96 21.97 L 23.95 21.57 A 0.49 0.47 2.8 0 1 23.47 21.06 Q 23.76 17.64 25.00 12.00 Q 25.58 9.36 24.28 10.12 Q 23.80 10.40 23.50 11.09 Q 22.79 12.80 21.92 14.42 Z M 15.57 22.41 A 0.62 0.62 0 0 0 14.95 21.79 L 10.01 21.79 A 0.62 0.62 0 0 0 9.39 22.41 L 9.39 40.07 A 0.62 0.62 0 0 0 10.01 40.69 L 14.95 40.69 A 0.62 0.62 0 0 0 15.57 40.07 L 15.57 22.41 Z" fill-opacity="1.000"></path>
      <circle r="1.51" cy="37.50" cx="12.49" fill-opacity="1.000"></circle>
    </svg>
  </button>

    <button class="likes-button" (click)="toggleLikesPopup()" title="Click to see who liked this post">
      ❤️ {{ post.likes }} Like{{ post.likes > 1 ? 's' : '' }} 
    </button>
  </div>

  <!-- Comments Section -->
  <div class="comments-section">
    <h3 class="comments-title">
      💬 Commentaires ({{ comments.length }})
    </h3>
    <div *ngFor="let comment of comments" class="post-comment">
      <p class="comment-author">
        <strong>👤 {{ commentAuthors.get(comment.userId) }}
        </strong>
      </p> 
      <p class="comment-content">{{ comment.content }}</p>
      <p class="comment-date">
        📅 {{ comment.createdAt | date: 'medium' }}
      </p>

      <!-- Likes Section for each Comment -->
      <div class="comment-likes-section">
        <button (click)="likeComment(comment.id)" class="like-button">
          👍 
        </button>
        <span class="likes-count">{{ comment.likes }} Like{{ comment.likes > 1 ? 's' : '' }}</span>
      </div>

     <!-- Delete Comment Button -->
<button 
*ngIf="comment.userId === userId"  
class="delete-comment-button red-button" 
(click)="deleteComment(comment.id)">
🗑️ Delete Comment 
</button>

      
    </div>
    

    <!-- Add Comment Section -->
    <div class="add-comment">
      <textarea [(ngModel)]="newCommentContent" placeholder="Add a comment..." rows="3"></textarea>
      <button class="btn-emoji" (click)="toggleEmojiPicker()">
        😊 <i class="bi bi-emoji-smile"></i>
      </button>
      
      <!-- Emoji Picker Popup -->
<div class="emoji-picker-popup" *ngIf="showEmojiPicker">
  <emoji-mart 
    [emoji]="''" 
    [set]="'facebook'" 
    [perLine]="10"
    (emojiClick)="onSelectEmojis($event)">
  </emoji-mart>
</div>

      
      <button (click)="addComment()" > ➕ Post Comment
        
      </button>
    </div>
  </div>

  <!-- Likes Popup Modal for Post -->
  <div class="likes-modal" *ngIf="showLikesPopup">
    <div class="likes-modal-content">
      <h3 class="likes-modal-title">
        👥 Liked By :
      </h3>
      <ul class="likes-list">
        <span class="likes-modal-close" (click)="toggleLikesPopup()">×</span>
        <li *ngFor="let userId of post.likedBy" class="likes-list-item">
          👤 {{ userNames.get(userId) || 'Loading...' }}
        </li>
      </ul>
    </div>
  </div>

  <!-- Scroll To Top Button -->
  <button class="button" (click)="scrollToTop()" title="Go to top">
    <svg class="svgIcon" viewBox="0 0 384 512">
      <path
        d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z">
      </path>
    </svg>
  </button>

  <!-- Custom Confirmation Modal -->
<div *ngIf="showConfirmModal" class="custom-modal-backdrop">
  <div class="custom-modal">
    <h3>Confirmer la suppression</h3>
    <p>Êtes-vous sûr de vouloir supprimer ce post ?</p>
    <div class="modal-buttons">
      <button class="btn btn-secondary" (click)="cancelDelete()">Annuler</button>
      <button class="btn btn-danger" (click)="confirmDelete()">Supprimer</button>
    </div>
  </div>
</div>

</div>

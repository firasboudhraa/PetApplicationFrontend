<div class="container">
  <h2>Liste des Posts</h2>

  <table class="posts-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Image</th>
        <th>Titre</th>
        <th>Auteur</th>
        <th>Type</th>
        <th>Likes</th>
        <th>Commentaires</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let post of posts; let i = index">
        <tr>
          <td>{{ i + 1 }}</td>
          <td>
            <img [src]="'http://localhost:8082/posts/images/' + post.imageUrl" alt="Post Image" class="post-img">
          </td>
          <td>{{ post.title }}</td>
          <td>{{ userNames.get(post.userId) }}</td>
          <td>{{ post.type }}</td>
          <td>{{ likeCounts[post.id] || 0 }}</td>
          <td>{{ commentCounts[post.id] || 0 }}</td>
          <td>{{ post.createdAt | date: 'medium' }}</td>
          <td>
            <button class="btn btn-red" (click)="deletePost(post.id)">Supprimer</button>
            <button class="btn btn-blue" (click)="openCommentsPopup(post.id)">Voir commentaires</button>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <!-- Modal Commentaires -->
  <div class="modal" *ngIf="selectedPostId !== null">
    <div class="modal-content">
      <span class="close" (click)="closePopup()">&times;</span>
      <h3>Commentaires du post</h3>

      <div *ngIf="selectedPostId !== null && postComments[selectedPostId] && postComments[selectedPostId].length > 0; else noComments">
        <ul class="comments-list">
          <li *ngFor="let comment of postComments[selectedPostId]">
            <strong>{{ userNames.get(comment.userId) || 'Inconnu' }}</strong> : {{ comment.content }}
            <button class="btn btn-small-red" (click)="deleteComment(comment.id, selectedPostId)">âœ– Delete</button>
          </li>
        </ul>
      </div>

      <ng-template #noComments>
        <p>Aucun commentaire pour ce post.</p>
      </ng-template>
    </div>
  </div>

</div>
